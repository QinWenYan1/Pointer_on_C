# 📘 Chapter 01 — 习题解答

以下为《Pointers on C》第 XX 章的习题答案整理，每道题均保留原题内容并附上简要解答。

---

## 1. C 是一种自由形式的语言，也就是说并没有规则规定它的外观究竟应该怎样。但本章的例子程序遵循了一定的空白使用规则。你对此有何想法？

✍️ **回答：**

让程序方便阅读，同时方便未来对程序的维护

---

## 2. 把声明（如函数原型的声明）放在头文件中，并在需要时用 `#include` 指令把它们包含于源文件中，这种做法有什么好处？

✍️ **回答：**

将函数声明集中放在头文件中，通过接口和实现的分离来提高代码的**可维护性**、通过避免重复声明来提高代码**可复用性**， 通过在头文件的统一对函数参数和类型修改保证(如需要)**类型安全性**，是 C 项目开发中标准的模块化设计方式。

---

## 3. 使用 `#define` 指令给字面值常量取名有什么好处？

✍️ **回答：**

如果命名得当，命名常量比字面常量更容易看出它代表的含义提高代码**可读性**，而字面常量只会显示一个具体的数值。同时，通过提高命名常量复用性来提供代码的**可维护性**。

---

## 4. 依次打印一个十进制整数、字符串和浮点值，你应该在 `printf` 函数中分别使用什么格式化代码？试编一例，让这些打印值以空格分隔，并在输出行的末尾添加一个换行符。

✍️ **回答：**

```c
printf("%d, %s, %g\n", 42, "hello", 3.14);
```
`%f` 始终以固定小数点形式输出浮点数，而 `%g` 会根据数值大小在 `%f` 和科学计数法 `%e` 之间自动选择更简洁的表示方式，并去除多余的尾部零。


## 5. 编写一条 `scanf` 语句，它需要读取两个整数，分别保存在 `quantity` 和 `price` 变量，然后再读取一个字符串，保存在一个名叫 `department` 的字符数组中。

✍️ **回答：**

```c
scanf("%d %d %s", &quantity, &price, &department);
```


## 6. C 语言并不执行数组下标的有效性检查。你觉得为什么这个明显的安全手段会从语言中省略？

✍️ **回答：**
C 语言设计之初更关注性能和灵活性，而不是安全性。进行下标检查会带来额外的运行时开销，影响效率。C 假设程序员对内存管理负责，因此没有内建的越界检测机制。这给程序员更大的控制权，但也带来了更高的出错风险。

程序员可以在确实需要的地方手动加上下标检查，比如在其他地方已经验证过的情况下就无需再次检查。
但真正的原因是：**数组下标本质上是指针运算**，这在 C 中无法高效地自动检查。


## 7. 本章描述的 rearrange 程序包含下面的语句：

```c
strncpy(output + output_col, input + columns[col], nchars);
```
`strcpy` 函数只接受两个参数，所以它实际复制的字符数由第 2 个参数决定。在本程序中，如果用 `strcpy` 函数取代 `strncpy` 函数会出现什么结果？

✍️ **回答：**
`strcpy(dest, src)` 会从 `src` 一直复制字符到 `dest`，直到遇到字符串结束符 `\0`；而 `strncpy(dest, src, n)` 最多只复制 `n` 个字符，适合部分复制，且能避免越界。

在该程序中，使用 `strncpy` 是为了精确控制复制长度。如果改用 `strcpy`，可能会复制超出预期范围的数据，甚至导致缓冲区溢出，破坏内存安全。


## 8. rearrange 程序包含下面的语句：
```c
while (gets(input) != NULL) {
```
你认为这段代码可能会出现什么问题？

✍️ **回答：**
`gets()` 是一个不安全的输入函数，因为它不会检查输入是否超过目标数组的容量。换句话说，它不知道你定义的数组有多大，会一直读入用户输入，直到遇到换行符为止。比如:
```c
char input[10];
gets(input);  // 如果用户输入超过 10 个字符，就会发生缓冲区溢出
```
因此，`gets()` 函数被认为极其危险，***已经在 C11 标准中被正式移除***， 取而代之的是`fgets()`。
`fgets()` 可以指定读取的最大字符数，从而避免溢出：
```c
fgets(input, sizeof(input), stdin);
```
- `sizeof(input)` 确保读取的字符不会超过数组容量。
- `fgets()` 会保留换行符（如存在），也更安全。